## Практическая работа №9. Вуйко Ярослава, ЭФМО-01-25

Реализация регистрации и входа пользователей. Хэширование паролей с bcrypt. 18.11.2025

## Описание проекта
Проект представляет собой реализацию процесса регистрации и входа.

### Практическая схема регистрации
1.	Пользователь отправляет email и пароль.
2.	Сервер проверяет корректность (валидный email, пароль ≥ 8 символов).
3.	Пароль хэшируется через bcrypt.
4.	В базу сохраняются: email и bcrypt-хэш.

### Практическая схема входа
1.	Пользователь отправляет email и пароль.
2.	Сервер ищет пользователя по email.
3.	Сравнивает хэш из базы и введённый пароль через bcrypt.
4.	Если совпадает → вход успешен.
5.	Если нет → возвращается ошибка.


## Структура проекта

```
.
├── cmd/
│   └── api/
│       └── main.go              
├── internal/
│   ├── core/       
│   │   └── user.go         
│   ├── htt/
|   |   └── handlers/
│   |         └── auth.go
│   ├── platform/
|   |     └── config/
│   |           └── config.go
│   └── repo/       
│       └── postgres.go           
├── go.mod 
├── go.sum                      
└── README.md                    
```



### Регистрация
<img width="972" height="597" alt="2025-11-18_17-27-08" src="https://github.com/user-attachments/assets/4b0f5d1c-7a0e-4685-bc6a-c6a8c312e51d" />

### Повторная попытка регистрации
<img width="1131" height="531" alt="2025-11-18_17-44-27" src="https://github.com/user-attachments/assets/f1a8d4a9-dca9-4bab-8d99-a52a6d1e65f8" />

### Вход с верными данными
<img width="1127" height="620" alt="2025-11-18_17-28-01" src="https://github.com/user-attachments/assets/9ac34954-cd49-44f8-b46b-7c4ab32de3b2" />

### Вход с неверными данными
<img width="1118" height="568" alt="image" src="https://github.com/user-attachments/assets/dec8e5c1-48df-4c98-989e-26e47dc2e473" />

### Функция регистрации
<img width="821" height="828" alt="image" src="https://github.com/user-attachments/assets/771da0b9-c7b4-45de-9ffa-f0b57cdb29e3" />

### Функция входа
<img width="882" height="730" alt="image" src="https://github.com/user-attachments/assets/5710b55a-f7bd-4dd4-8ecc-b163de0281d7" />

### Место вызова bcrypt.GenerateFromPassword
<img width="771" height="158" alt="image" src="https://github.com/user-attachments/assets/a80c6092-0360-4d2d-be10-ae1b3457d233" />

### Место вызова bcrypt.CompareHashAndPassword
<img width="887" height="117" alt="image" src="https://github.com/user-attachments/assets/5f8ed572-6b05-4f71-bce3-9ecf8e489707" />

### AutoMigrate
<img width="454" height="111" alt="image" src="https://github.com/user-attachments/assets/10e52578-236c-4a23-ac96-3a1457d1a37e" />

### Структура БД
<img width="813" height="205" alt="image" src="https://github.com/user-attachments/assets/2e3ab0aa-aaa5-4d71-aa08-ff36e07407e4" />


### Переменные окружения
1. export DB_DSN="postgres://user:password@localhost:5432/pz9?sslmode=disable"
2. export BCRYPT_COST=12          
3. export APP_ADDR=":8080"        


### Почему нельзя хранить пароли в открытом виде; почему bcrypt. 
Пароли нельзя хранить в открытом виде, потому что при компрометации базы данных злоумышленники получат прямой доступ к учетным данным всех пользователей, что приведет к массовым утечкам и возможности несанкционированного доступа к системам. Bcrypt является предпочтительным выбором для хеширования паролей, поскольку он специально разработан для устойчивости к brute-атакам благодаря адаптивной функции формирования ключа, автоматическому добавлению "соли" для защиты от rainbow-таблиц и возможности настройки вычислительной сложности, что замедляет перебор даже на мощном оборудовании.



## Ответы на контрольные вопросы:
1. В чём разница между хранением пароля и хранением его хэша? Зачем соль? Почему bcrypt, а не SHA-256?
Хранение пароля в открытом виде опасно при утечке БД, тогда как хэш необратим. Соль защищает от rainbow-таблиц и одинаковых хэшей у пользователей. Bcrypt предпочтительнее SHA-256, так как он медленнее и устойчивее к перебору из-за адаптивной сложности.
2. Что произойдёт при снижении/повышении cost у bcrypt? Как подобрать значение?
Снижение cost ускорит генерацию и проверку хэша, но уменьшит стойкость к brute-force. Повышение cost увеличит время вычислений, усиливая защиту. Значение подбирают балансируя между безопасностью (≥12) и производительностью сервера.
3. Какие статусы и ответы должны возвращать POST /auth/register и POST /auth/login в типичных сценариях?
Register: 201 при успехе, 409 при занятом email, 400 при неверных данных. Login: 200 при верных данных, 401 при ошибках аутентификации, 400 при отсутствии email/пароля.
4. Какие риски несут подробные сообщения об ошибках при логине?
Подробности (например, "email не найден" вместо "неверные данные") раскрывают наличие учётных записей в системе, что упрощает подбор и атаки перечислением пользователей.
5. Почему в этом ПЗ не выдаём токен, и что изменится в ПЗ10 (JWT)?
В ПЗ9 фокус на базовой аутентификации, а в ПЗ10 добавится JWT-токен для stateless-авторизации, передаваемый в заголовках запросов вместо повторной проверки пароля.


